<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= project.title %> - Project</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/dark-theme.css">
    <link rel="stylesheet" href="/css/project.css">
    <link rel="stylesheet" href="/css/projects.css">
</head>
<body>
    <div class="bubble-container" id="bubbleContainer"></div>
    <div class="glow-border"></div>
    <div class="glow-border-left"></div>
    <div class="glow-border-right"></div>

    <%- include('partials/nav', { isFiancee: false }) %>

    <div class="main-container">
        <section class="hero-section" style="min-height: 40vh;">
            <h1 class="hero-title"><span class="gradient-text"><%= project.title %></span></h1>
            <p class="hero-subtitle">Project Overview & Media</p>
        </section>

        <section class="project-detail-section">
            <div class="project-detail-grid">
                <div class="project-media card">
                    <% if (project.video_url) { %>
                        <video class="project-video" controls>
                            <source src="<%= project.video_url %>" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    <% } else if (project.background_img) { %>
                        <img src="<%= project.background_img %>" alt="<%= project.title %>" class="project-cover"/>
                    <% } %>
                    <div class="thumb-row">
                        <% if (project.background_img) { %>
                            <img src="<%= project.background_img %>" class="thumb" data-src="<%= project.background_img %>">
                        <% } %>
                        <% if (project.img2) { %>
                            <img src="<%= project.img2 %>" class="thumb" data-src="<%= project.img2 %>">
                        <% } %>
                        <% if (project.img3) { %>
                            <img src="<%= project.img3 %>" class="thumb" data-src="<%= project.img3 %>">
                        <% } %>
                        <% if (project.img4) { %>
                            <img src="<%= project.img4 %>" class="thumb" data-src="<%= project.img4 %>">
                        <% } %>
                    </div>
                </div>
                <div class="project-info card">
                    <h2 class="project-info-title">About this project</h2>
                    <p class="project-info-desc"><%- project.description.replace(/\n/g, '<br>') %></p>
                    <div class="project-actions">
                        <% if (project.github_link && project.github_link.trim()) { %>
                            <a href="<%= project.github_link %>" class="project-btn" target="_blank"><span>GitHub</span><i class="fas fa-code-branch"></i></a>
                        <% } else { %>
                            <span class="project-btn disabled"><span>GitHub</span><i class="fas fa-code-branch"></i></span>
                        <% } %>
                        <% if (project.live_demo && project.live_demo.trim()) { %>
                            <a href="<%= project.live_demo %>" class="project-btn" target="_blank"><span>Live Demo</span><i class="fas fa-external-link-alt"></i></a>
                        <% } else { %>
                            <span class="project-btn disabled"><span>Live Demo</span><i class="fas fa-external-link-alt"></i></span>
                        <% } %>
                    </div>
                    <% if (project.walkthrough_step1 || project.walkthrough_step2 || project.walkthrough_step3) { %>
                    <div class="walkthrough">
                        <h3 class="project-info-title">Walkthrough</h3>
                        <ol class="walkthrough-list">
                            <% if (project.walkthrough_step1) { %><li><%= project.walkthrough_step1 %></li><% } %>
                            <% if (project.walkthrough_step2) { %><li><%= project.walkthrough_step2 %></li><% } %>
                            <% if (project.walkthrough_step3) { %><li><%= project.walkthrough_step3 %></li><% } %>
                        </ol>
                    </div>
                    <% } %>
                </div>
            </div>
        </section>
    </div>

    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    
    <%- include('partials/common_scripts') %>
    
    <script>
        // Image gallery with lightbox
        const cover = document.querySelector('.project-cover');
        const thumbs = document.querySelectorAll('.thumb');
        
        // Switch main image on thumbnail click
        if (cover && thumbs.length > 0) {
            thumbs.forEach(t => {
                // Regular click to switch
                t.addEventListener('click', (e) => {
                    if (window.innerWidth > 768) {
                        // Desktop: just switch the image
                        cover.src = t.dataset.src;
                    } else {
                        // Mobile: open in lightbox
                        openLightbox(t.dataset.src);
                    }
                });
            });
            
            // Desktop: click main image to open lightbox
            if (window.innerWidth > 768) {
                cover.addEventListener('click', () => {
                    openLightbox(cover.src);
                });
            }
        }
        
        // Lightbox functionality
        function openLightbox(src) {
            const lightbox = document.createElement('div');
            lightbox.className = 'image-lightbox';
            lightbox.innerHTML = `
                <div class="lightbox-content">
                    <img src="${src}" alt="Project image">
                    <button class="lightbox-close" onclick="this.parentElement.parentElement.remove()">&times;</button>
                </div>
            `;
            document.body.appendChild(lightbox);
            
            // Close on background click
            lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox) {
                    lightbox.remove();
                }
            });
        }
    </script>
</body>
</html>
